---
title: 'Lab 3: Reserve Planning using prioritizr'
author: "Halina Do-Linh"
date: "1/26/2022"
output: html_document
---

# Setup

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## 1.2 R packages

```{r}
### run in console only ###

# if (!require("librarian")){
#   install.packages("librarian")
#   library(librarian)
# }
# librarian::shelf(
#   assertthat, BiocManager, dplyr, gridExtra, here, mapview,
#   prioritizr, prioritizrdata,
#   raster, remotes, rgeos, rgdal, scales, sf, sp, stringr,
#   units)
# if (!require("lpsymphony")){
#   BiocManager::install("lpsymphony")
#   library(lpsymphony)
# }
```

## 1.3 Data Setup

```{r}
dir_data <- here::here("data/prioritizr")
pu_shp   <- file.path(dir_data, "pu.shp")
pu_url   <- "https://github.com/prioritizr/massey-workshop/raw/main/data.zip"
pu_zip   <- file.path(dir_data, basename(pu_url))
vegetation_tif <- file.path(dir_data, "vegetation.tif")

dir.create(dir_data, showWarnings = F, recursive = T)
if (!file.exists(pu_shp)){
  download.file(pu_url, pu_zip)
  unzip(pu_zip, exdir = dir_data)
  dir_unzip   <- file.path(dir_data, "data")
  files_unzip <- list.files(dir_unzip, full.names = T)
  file.rename(
    files_unzip, 
    files_unzip %>% str_replace("prioritizr/data", "prioritizr"))
  unlink(c(pu_zip, dir_unzip), recursive = T)
}
```
# Data

## 2.1 Data import

```{r}
# import planning unit data
pu_data <- as(sf::read_sf(pu_shp), "Spatial")

# format columns in planning unit data
pu_data$locked_in <- as.logical(pu_data$locked_in)
pu_data$locked_out <- as.logical(pu_data$locked_out)

# import vegetation data
veg_data <- stack(vegetation_tif)
```


## Planning unit data

```{r}
# print a short summary of the data
print(pu_data)
```


```{r}
# plot the planning unit data
plot(pu_data)
```

```{r}
# plot an interactive map of the planning unit data
mapview(pu_data)
```

```{r}
# print the structure of object
str(pu_data, max.level = 2)
```

```{r}
# print the class of the object
class(pu_data)
```


```{r}
# print the slots of the object
slotNames(pu_data)
```


```{r}
# print the coordinate reference system
print(pu_data@proj4string)
```


```{r}
# print number of planning units (geometries) in the data
tot_pu <- nrow(pu_data)
```


```{r}
# print the first six rows in the data
head(pu_data@data)
```


```{r}
# print the first six values in the cost column of the attribute data
head(pu_data$cost)
```


```{r}
# print the highest cost value
max_cost <- max(pu_data$cost)
```


```{r}
# print the smallest cost value
min(pu_data$cost)
```


```{r}
# print average cost value
mean(pu_data$cost)
```


```{r}
# plot a map of the planning unit cost data
spplot(pu_data, "cost")
```


```{r}
# plot an interactive map of the planning unit cost data
mapview(pu_data, zcol = "cost")
```


## Questions
How many planning units are in the planning unit data?
**Answer:** There are `r tot_pu` planning units in the planning unit data.

What is the highest cost value?
**Answer:** The highest cost value is `r max_cost`.

Is there a spatial pattern in the planning unit cost values (hint: use plot to make a map)? 
**Answer:** Yes, from the plots you can see that planning unit cost values are significantly lower in the eastern part of southern Tasmania than central or western southern Tasmania. 

# Vegetation Data

```{r}
# print a short summary of the data
print(veg_data)
```


```{r}
# plot a map of the 20th vegetation class
plot(veg_data[[20]])
```


```{r}
# plot an interactive map of the 20th vegetation class
mapview(veg_data[[20]])
```


```{r}
# print number of rows in the data
nrow(veg_data)
```


```{r}
# print number of columns  in the data
ncol(veg_data)
```


```{r}
# print number of cells in the data
ncell(veg_data)
```


```{r}
# print number of layers in the data
nlayers(veg_data)
```



```{r}
# print resolution on the x-axis
xres(veg_data)
```


```{r}
# print resolution on the y-axis
yres(veg_data)
```

**Halina Note:** How do the number of cells relate to the xy resolution? 


```{r}
# print spatial extent of the grid, i.e. coordinates for corners
extent(veg_data)
```

```{r}
# print the coordinate reference system
print(veg_data@crs)
```


```{r}
# print a summary of the first layer in the stack
print(veg_data[[1]])
```


```{r}
# print the value in the 800th cell in the first layer of the stack
print(veg_data[[1]][800])
```


```{r}
# print the value of the cell located in the 30th row and the 60th column of
# the first layer
print(veg_data[[1]][30, 60])
```


```{r}
# calculate the sum of all the cell values in the first layer
cellStats(veg_data[[1]], "sum")
```


```{r}
# calculate the maximum value of all the cell values in the first layer
cellStats(veg_data[[1]], "max")
```


```{r}
# calculate the minimum value of all the cell values in the first layer
cellStats(veg_data[[1]], "min")
```


```{r}
# calculate the mean value of all the cell values in the first layer
cellStats(veg_data[[1]], "mean")
```


## Questions
What part of the study area is the 13th vegetation class found in (hint: make a map)? For instance, is it in the south-eastern part of the study area?

**Answer::** The study area of the 13th vegetation class is in the south-eastern part of Tasmania.

```{r}
mapview(veg_data[[13]])
```


What proportion of cells contain the 12th vegetation class?
**Answer:**

```{r}
print(veg_data[[12]])
```

Which vegetation class is the most abundant (i.e. present in the greatest number of cells)? 
**Answer:**

```{r}
cellStats(veg_data, "max")
```


